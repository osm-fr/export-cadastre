(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(process,global){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.ES6Promise=factory()})(this,function(){"use strict";function objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}function isFunction(x){return typeof x==="function"}var _isArray=undefined;if(!Array.isArray){_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}else{_isArray=Array.isArray}var isArray=_isArray;var len=0;var vertxNext=undefined;var customSchedulerFn=undefined;var asap=function asap(callback,arg){queue[len]=callback;queue[len+1]=arg;len+=2;if(len===2){if(customSchedulerFn){customSchedulerFn(flush)}else{scheduleFlush()}}};function setScheduler(scheduleFn){customSchedulerFn=scheduleFn}function setAsap(asapFn){asap=asapFn}var browserWindow=typeof window!=="undefined"?window:undefined;var browserGlobal=browserWindow||{};var BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;var isNode=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function useNextTick(){return function(){return process.nextTick(flush)}}function useVertxTimer(){if(typeof vertxNext!=="undefined"){return function(){vertxNext(flush)}}return useSetTimeout()}function useMutationObserver(){var iterations=0;var observer=new BrowserMutationObserver(flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=flush;return function(){return channel.port2.postMessage(0)}}function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}var queue=new Array(1e3);function flush(){for(var i=0;i<len;i+=2){var callback=queue[i];var arg=queue[i+1];callback(arg);queue[i]=undefined;queue[i+1]=undefined}len=0}function attemptVertx(){try{var r=require;var vertx=r("vertx");vertxNext=vertx.runOnLoop||vertx.runOnContext;return useVertxTimer()}catch(e){return useSetTimeout()}}var scheduleFlush=undefined;if(isNode){scheduleFlush=useNextTick()}else if(BrowserMutationObserver){scheduleFlush=useMutationObserver()}else if(isWorker){scheduleFlush=useMessageChannel()}else if(browserWindow===undefined&&typeof require==="function"){scheduleFlush=attemptVertx()}else{scheduleFlush=useSetTimeout()}function then(onFulfillment,onRejection){var _arguments=arguments;var parent=this;var child=new this.constructor(noop);if(child[PROMISE_ID]===undefined){makePromise(child)}var _state=parent._state;if(_state){(function(){var callback=_arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result)})})()}else{subscribe(parent,child,onFulfillment,onRejection)}return child}function resolve(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor(noop);_resolve(promise,object);return promise}var PROMISE_ID=Math.random().toString(36).substring(16);function noop(){}var PENDING=void 0;var FULFILLED=1;var REJECTED=2;var GET_THEN_ERROR=new ErrorObject;function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function getThen(promise){try{return promise.then}catch(error){GET_THEN_ERROR.error=error;return GET_THEN_ERROR}}function tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then){asap(function(promise){var sealed=false;var error=tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){_resolve(promise,value)}else{fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;_reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;_reject(promise,error)}},promise)}function handleOwnThenable(promise,thenable){if(thenable._state===FULFILLED){fulfill(promise,thenable._result)}else if(thenable._state===REJECTED){_reject(promise,thenable._result)}else{subscribe(thenable,undefined,function(value){return _resolve(promise,value)},function(reason){return _reject(promise,reason)})}}function handleMaybeThenable(promise,maybeThenable,then$$){if(maybeThenable.constructor===promise.constructor&&then$$===then&&maybeThenable.constructor.resolve===resolve){handleOwnThenable(promise,maybeThenable)}else{if(then$$===GET_THEN_ERROR){_reject(promise,GET_THEN_ERROR.error)}else if(then$$===undefined){fulfill(promise,maybeThenable)}else if(isFunction(then$$)){handleForeignThenable(promise,maybeThenable,then$$)}else{fulfill(promise,maybeThenable)}}}function _resolve(promise,value){if(promise===value){_reject(promise,selfFulfillment())}else if(objectOrFunction(value)){handleMaybeThenable(promise,value,getThen(value))}else{fulfill(promise,value)}}function publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}publish(promise)}function fulfill(promise,value){if(promise._state!==PENDING){return}promise._result=value;promise._state=FULFILLED;if(promise._subscribers.length!==0){asap(publish,promise)}}function _reject(promise,reason){if(promise._state!==PENDING){return}promise._state=REJECTED;promise._result=reason;asap(publishRejection,promise)}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers;var length=_subscribers.length;parent._onerror=null;_subscribers[length]=child;_subscribers[length+FULFILLED]=onFulfillment;_subscribers[length+REJECTED]=onRejection;if(length===0&&parent._state){asap(publish,parent)}}function publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child=undefined,callback=undefined,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function ErrorObject(){this.error=null}var TRY_CATCH_ERROR=new ErrorObject;function tryCatch(callback,detail){try{return callback(detail)}catch(e){TRY_CATCH_ERROR.error=e;return TRY_CATCH_ERROR}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=undefined,error=undefined,succeeded=undefined,failed=undefined;if(hasCallback){value=tryCatch(callback,detail);if(value===TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){_reject(promise,cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==PENDING){}else if(hasCallback&&succeeded){_resolve(promise,value)}else if(failed){_reject(promise,error)}else if(settled===FULFILLED){fulfill(promise,value)}else if(settled===REJECTED){_reject(promise,value)}}function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){_resolve(promise,value)},function rejectPromise(reason){_reject(promise,reason)})}catch(e){_reject(promise,e)}}var id=0;function nextId(){return id++}function makePromise(promise){promise[PROMISE_ID]=id++;promise._state=undefined;promise._result=undefined;promise._subscribers=[]}function Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(noop);if(!this.promise[PROMISE_ID]){makePromise(this.promise)}if(isArray(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0){fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){fulfill(this.promise,this._result)}}}else{_reject(this.promise,validationError())}}function validationError(){return new Error("Array Methods must be provided an Array")}Enumerator.prototype._enumerate=function(){var length=this.length;var _input=this._input;for(var i=0;this._state===PENDING&&i<length;i++){this._eachEntry(_input[i],i)}};Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor;var resolve$$=c.resolve;if(resolve$$===resolve){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING){this._settledAt(entry._state,i,entry._result)}else if(typeof _then!=="function"){this._remaining--;this._result[i]=entry}else if(c===Promise){var promise=new c(noop);handleMaybeThenable(promise,entry,_then);this._willSettleAt(promise,i)}else{this._willSettleAt(new c(function(resolve$$){return resolve$$(entry)}),i)}}else{this._willSettleAt(resolve$$(entry),i)}};Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===PENDING){this._remaining--;if(state===REJECTED){_reject(promise,value)}else{this._result[i]=value}}if(this._remaining===0){fulfill(promise,this._result)}};Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;subscribe(promise,undefined,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})};function all(entries){return new Enumerator(this,entries).promise}function race(entries){var Constructor=this;if(!isArray(entries)){return new Constructor(function(_,reject){return reject(new TypeError("You must pass an array to race."))})}else{return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++){Constructor.resolve(entries[i]).then(resolve,reject)}})}}function reject(reason){var Constructor=this;var promise=new Constructor(noop);_reject(promise,reason);return promise}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Promise(resolver){this[PROMISE_ID]=nextId();this._result=this._state=undefined;this._subscribers=[];if(noop!==resolver){typeof resolver!=="function"&&needsResolver();this instanceof Promise?initializePromise(this,resolver):needsNew()}}Promise.all=all;Promise.race=race;Promise.resolve=resolve;Promise.reject=reject;Promise._setScheduler=setScheduler;Promise._setAsap=setAsap;Promise._asap=asap;Promise.prototype={constructor:Promise,then:then,"catch":function _catch(onRejection){return this.then(null,onRejection)}};function polyfill(){var local=undefined;if(typeof global!=="undefined"){local=global}else if(typeof self!=="undefined"){local=self}else{try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if(promiseToString==="[object Promise]"&&!P.cast){return}}local.Promise=Promise}Promise.polyfill=polyfill;Promise.Promise=Promise;return Promise})}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:3}],2:[function(require,module,exports){(function(){"use strict";L.Map=L.Map.extend({sync:function(map,options){this._initSync();options=options||{};var present=false;this._syncMaps.forEach(function(other){if(map===other){present=true}});if(!present){this._syncMaps.push(map)}if(!options.noInitialSync){map.setView(this.getCenter(),this.getZoom(),{animate:false,reset:true})}return this},unsync:function(map){var self=this;if(this._syncMaps){this._syncMaps.forEach(function(synced,id){if(map===synced){self._syncMaps.splice(id,1)}})}return this},_initSync:function(){if(this._syncMaps){return}var originalMap=this;this._syncMaps=[];L.extend(originalMap,{setView:function(center,zoom,options,sync){if(!sync){originalMap._syncMaps.forEach(function(toSync){toSync.setView(center,zoom,options,true)})}return L.Map.prototype.setView.call(this,center,zoom,options)},panBy:function(offset,options,sync){if(!sync){originalMap._syncMaps.forEach(function(toSync){toSync.panBy(offset,options,true)})}return L.Map.prototype.panBy.call(this,offset,options)},_onResize:function(event,sync){if(!sync){originalMap._syncMaps.forEach(function(toSync){toSync._onResize(event,true)})}return L.Map.prototype._onResize.call(this,event)}});originalMap.on("zoomend",function(){originalMap._syncMaps.forEach(function(toSync){toSync.setView(originalMap.getCenter(),originalMap.getZoom(),{animate:false,reset:false})})},this);originalMap.dragging._draggable._updatePosition=function(){L.Draggable.prototype._updatePosition.call(this);var self=this;originalMap._syncMaps.forEach(function(toSync){L.DomUtil.setPosition(toSync.dragging._draggable._element,self._newPos);toSync.eachLayer(function(l){if(l._google!==undefined){l._google.setCenter(originalMap.getCenter())}});toSync.fire("moveend")})}}})})()},{}],3:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],4:[function(require,module,exports){(function(self){"use strict";if(self.fetch){return}var support={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{new Blob;return true}catch(e){return false}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if(support.arrayBuffer){var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];var isDataView=function(obj){return obj&&DataView.prototype.isPrototypeOf(obj)};var isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1}}function normalizeName(name){if(typeof name!=="string"){name=String(name)}if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(name)){throw new TypeError("Invalid character in header field name")}return name.toLowerCase()}function normalizeValue(value){if(typeof value!=="string"){value=String(value)}return value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:value===undefined,value:value}}};if(support.iterable){iterator[Symbol.iterator]=function(){return iterator}}return iterator}function Headers(headers){this.map={};if(headers instanceof Headers){headers.forEach(function(value,name){this.append(name,value)},this)}else if(headers){Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name])},this)}}Headers.prototype.append=function(name,value){name=normalizeName(name);value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+","+value:value};Headers.prototype["delete"]=function(name){delete this.map[normalizeName(name)]};Headers.prototype.get=function(name){name=normalizeName(name);return this.has(name)?this.map[name]:null};Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))};Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)};Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map){if(this.map.hasOwnProperty(name)){callback.call(thisArg,this.map[name],name,this)}}};Headers.prototype.keys=function(){var items=[];this.forEach(function(value,name){items.push(name)});return iteratorFor(items)};Headers.prototype.values=function(){var items=[];this.forEach(function(value){items.push(value)});return iteratorFor(items)};Headers.prototype.entries=function(){var items=[];this.forEach(function(value,name){items.push([name,value])});return iteratorFor(items)};if(support.iterable){Headers.prototype[Symbol.iterator]=Headers.prototype.entries}function consumed(body){if(body.bodyUsed){return Promise.reject(new TypeError("Already read"))}body.bodyUsed=true}function fileReaderReady(reader){return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)};reader.onerror=function(){reject(reader.error)}})}function readBlobAsArrayBuffer(blob){var reader=new FileReader;var promise=fileReaderReady(reader);reader.readAsArrayBuffer(blob);return promise}function readBlobAsText(blob){var reader=new FileReader;var promise=fileReaderReady(reader);reader.readAsText(blob);return promise}function readArrayBufferAsText(buf){var view=new Uint8Array(buf);var chars=new Array(view.length);for(var i=0;i<view.length;i++){chars[i]=String.fromCharCode(view[i])}return chars.join("")}function bufferClone(buf){if(buf.slice){return buf.slice(0)}else{var view=new Uint8Array(buf.byteLength);view.set(new Uint8Array(buf));return view.buffer}}function Body(){this.bodyUsed=false;this._initBody=function(body){this._bodyInit=body;if(!body){this._bodyText=""}else if(typeof body==="string"){this._bodyText=body}else if(support.blob&&Blob.prototype.isPrototypeOf(body)){this._bodyBlob=body}else if(support.formData&&FormData.prototype.isPrototypeOf(body)){this._bodyFormData=body}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this._bodyText=body.toString()}else if(support.arrayBuffer&&support.blob&&isDataView(body)){this._bodyArrayBuffer=bufferClone(body.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else if(support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))){this._bodyArrayBuffer=bufferClone(body)}else{throw new Error("unsupported BodyInit type")}if(!this.headers.get("content-type")){if(typeof body==="string"){this.headers.set("content-type","text/plain;charset=UTF-8")}else if(this._bodyBlob&&this._bodyBlob.type){this.headers.set("content-type",this._bodyBlob.type)}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8")}}};if(support.blob){this.blob=function(){var rejected=consumed(this);if(rejected){return rejected}if(this._bodyBlob){return Promise.resolve(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(new Blob([this._bodyArrayBuffer]))}else if(this._bodyFormData){throw new Error("could not read FormData body as blob")}else{return Promise.resolve(new Blob([this._bodyText]))}};this.arrayBuffer=function(){if(this._bodyArrayBuffer){return consumed(this)||Promise.resolve(this._bodyArrayBuffer)}else{return this.blob().then(readBlobAsArrayBuffer)}}}this.text=function(){var rejected=consumed(this);if(rejected){return rejected}if(this._bodyBlob){return readBlobAsText(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))}else if(this._bodyFormData){throw new Error("could not read FormData body as text")}else{return Promise.resolve(this._bodyText)}};if(support.formData){this.formData=function(){return this.text().then(decode)}}this.json=function(){return this.text().then(JSON.parse)};return this}var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}function Request(input,options){options=options||{};var body=options.body;if(typeof input==="string"){this.url=input}else{if(input.bodyUsed){throw new TypeError("Already read")}this.url=input.url;this.credentials=input.credentials;if(!options.headers){this.headers=new Headers(input.headers)}this.method=input.method;this.mode=input.mode;if(!body&&input._bodyInit!=null){body=input._bodyInit;input.bodyUsed=true}}this.credentials=options.credentials||this.credentials||"omit";if(options.headers||!this.headers){this.headers=new Headers(options.headers)}this.method=normalizeMethod(options.method||this.method||"GET");this.mode=options.mode||this.mode||null;this.referrer=null;if((this.method==="GET"||this.method==="HEAD")&&body){throw new TypeError("Body not allowed for GET or HEAD requests")}this._initBody(body)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})};function decode(body){var form=new FormData;body.trim().split("&").forEach(function(bytes){if(bytes){var split=bytes.split("=");var name=split.shift().replace(/\+/g," ");var value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}});return form}function parseHeaders(rawHeaders){var headers=new Headers;rawHeaders.split("\r\n").forEach(function(line){var parts=line.split(":");var key=parts.shift().trim();if(key){var value=parts.join(":").trim();headers.append(key,value)}});return headers}Body.call(Request.prototype);function Response(bodyInit,options){if(!options){options={}}this.type="default";this.status="status"in options?options.status:200;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in options?options.statusText:"OK";this.headers=new Headers(options.headers);this.url=options.url||"";this._initBody(bodyInit)}Body.call(Response.prototype);Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})};Response.error=function(){var response=new Response(null,{status:0,statusText:""});response.type="error";return response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(redirectStatuses.indexOf(status)===-1){throw new RangeError("Invalid status code")}return new Response(null,{status:status,headers:{location:url}})};self.Headers=Headers;self.Request=Request;self.Response=Response;self.fetch=function(input,init){return new Promise(function(resolve,reject){var request=new Request(input,init);var xhr=new XMLHttpRequest;xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||"")};options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;resolve(new Response(body,options))};xhr.onerror=function(){reject(new TypeError("Network request failed"))};xhr.ontimeout=function(){reject(new TypeError("Network request failed"))};xhr.open(request.method,request.url,true);if(request.credentials==="include"){xhr.withCredentials=true}if("responseType"in xhr&&support.blob){xhr.responseType="blob"}request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value)});xhr.send(typeof request._bodyInit==="undefined"?null:request._bodyInit)})};self.fetch.polyfill=true})(typeof self!=="undefined"?self:this)},{}],5:[function(require,module,exports){"use strict";Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function e(r){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof r)throw new TypeError("predicate must be a function");for(var e,n=Object(this),t=n.length>>>0,o=arguments[1],i=0;i<t;i++)if(e=n[i],r.call(o,e,i,n))return i;return-1},enumerable:!1,configurable:!1,writable:!1})},{}],6:[function(require,module,exports){"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function betterPad(e,t,n){var o=e.getSouthWest().distanceTo(e.getSouthEast()),r=e.getSouthWest().distanceTo(e.getNorthWest()),s=e.getSouthWest().distanceTo(e.getNorthEast()),i=(s+t)*(1+n),c=e.getCenter(),l=(e.getEast()-c.lng)*i/o,a=(e.getNorth()-c.lat)*i/r,u=L.latLngBounds(L.latLng(c.lat-a,c.lng-l),L.latLng(c.lat+a,c.lng+l));return u}function display_case(e){history.replaceState(void 0,void 0,"#"+e.id),null!=joinPolygons&&joinPolygons.remove(),joinPolygons=new JoinPolygons(e.coords1,e.coords2).addTo(map1).addTo(map2),joinPolygons.on("click",function(){window.open("https://www.openstreetmap.org/way/"+e.id1,"_blank"),window.open("https://www.openstreetmap.org/way/"+e.id2,"_blank")}),map1.fitBounds(betterPad(joinPolygons.getBounds(),5,.2)),document.getElementById("josm-link").href=josm_url(betterPad(joinPolygons.getBounds(),30,.5),[e.id1,e.id2]),document.getElementById("osm-edit-link").href=osm_url(joinPolygons.getCenter(),map1.getZoom()),joinPolygons.showBlinking()}function osm_url(e,t){return"https://www.openstreetmap.org/edit?lat="+e.lat+"&lon="+e.lng+"&zoom="+t}function josm_url(e,t){return"http://localhost:8111/load_and_zoom?left="+e.getWest()+"&bottom="+e.getSouth()+"&right="+e.getEast()+"&top="+e.getNorth()+"&select="+t.map(function(e){return"way"+e}).join(",")}function set_next_case_the_nearest(){var e=map1.getCenter(),t=cases.slice(cur_index).map(function(t){return t.latLng.distanceTo(e)}),n=t.indexOf(Math.min.apply(Math,_toConsumableArray(t)));if(n>0){var o=cases[cur_index+n];cases[cur_index+n]=cases[cur_index],cases[cur_index]=o}}function try_display_next(e){try{e&&set_next_case_the_nearest(),display_case(cases[cur_index])}catch(t){if("GeometryError"!=t.name)throw t;console.log("Invalid geometry: ",cases[cur_index].id),cases.splice(cur_index,1),cur_index-=1,next(e,null)}}function check_ok(e){if(!e.ok)throw new ConnectionError(e.statusText);return e}function connection_problem(e){if(console.log(e.message),!("ConnectionError"==e.name||"NetworkError"==e.name||"TypeError"==e.name&&e.message.startsWith("NetworkError")))throw e;got_connection_error=!0,alert("Problème de connection au serveur: "+e)}function next(e,t){if(cur_index+=1,null!==t)if(cases_ids.has(t)){var n=cases.findIndex(function(e){return e.id==t});n<cur_index?(cases=cases.slice(0,n).concat(cases.slice(n+1,cur_index)).concat([cases[n]]).concat(cases.slice(cur_index)),cur_index-=1):n>cur_index&&(cases=cases.slice(0,cur_index).concat(cases[n]).concat(cases.slice(cur_index,n)).concat(cases.slice(n+1)))}else cases.splice(cur_index).forEach(function(e){return cases_ids.delete(e.id)});if(cur_index<cases.length?try_display_next(e):need_display=!0,!request_send&&cur_index+5>=cases.length||null!=t){var o=void 0;if(null==t){var r=map1.getCenter();o="get.php?limit=20&lat="+r.lat+"&lon="+r.lng}else o="get.php?id="+t+"&limit=1";request_send=!0,fetch(o).then(function(e){return check_ok(e).json()}).then(function(n){var o=n.features.filter(function(e){return!cases_ids.has(e.id)}).map(function(e){return{id:e.id,latLng:L.latLng(e.properties.lat,e.properties.lon),id1:e.properties.way1,id2:e.properties.way2,coords1:e.geometry.geometries[0].coordinates[0],coords2:e.geometry.geometries[1].coordinates[0]}});cases=cases.concat(o),o.forEach(function(e){return cases_ids.add(e.id)}),request_send=!1,need_display&&(need_display=!1,cur_index<cases.length?try_display_next(e):null==t?alert("Il ne reste pour le moment plus aucun cas à traiter. Bravo à tous !"):(alert("Cas inconnu"),next(e,null)))}).catch(connection_problem),fetch_stats()}}function press(e){e.classList.add("choice-button-active"),setTimeout(function(){return e.classList.remove("choice-button-active")},300)}function show_reward(e){var t=document.getElementById(e);t.style.display="block",setTimeout(function(){t.classList.add("reward-zoom"),setTimeout(function(){t.classList.remove("reward-zoom"),t.style.display="none"},1e3)},50)}function choose(e,t){if(cur_index>=0&&cur_index<cases.length){t&&press(document.getElementById("button-"+e));var n="set.php?id="+cases[cur_index].id+"&choice="+e+"&session="+session;fetch(n,{method:"POST"}).then(function(e){return check_ok(e)}).catch(connection_problem),increment_stats(1),show_reward("join"==e?"plusone":"plusok"),next(!0,null)}}function go_back(e){if(cur_index>=1){e&&press(document.getElementById("button-back"));var t="set.php?id="+cases[cur_index-1].id+"&choice=back&session="+session;fetch(t,{method:"POST"}).then(function(e){return check_ok(e)}).catch(connection_problem),cur_index-=2,increment_stats(-1),next(!1,null)}}function fetch_stats(){fetch("stats.php").then(function(e){return check_ok(e).json()}).then(function(e){Object.keys(e).forEach(function(t){stats[t]=e[t]}),show_stats()})}function increment_stats(e){
stats.contributions_from_ip+=e,stats.contributions_distinct_cases+=e,stats.contributions+=e,show_stats()}function show_stats(){document.getElementById("count_users").innerHTML=stats.contributions_distinct_ips+" / "+stats.contributions,document.getElementById("count_cases").innerHTML=stats.contributions_distinct_cases+" / "+stats.cases,document.getElementById("count_ip").innerHTML=stats.contributions_from_ip}var _slicedToArray=function(){function e(e,t){var n=[],o=!0,r=!1,s=void 0;try{for(var i,c=e[Symbol.iterator]();!(o=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(r)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();require("leaflet.sync"),require("es6-promise").polyfill(),require("whatwg-fetch"),require("./findIndex");var map1=L.map("map1"),map2=L.map("map2",{zoomControl:!1});map1.attributionControl.setPrefix(""),map2.attributionControl.setPrefix(""),map1.setView([18.227,-61.645],13),map2.setView([18.227,-61.645],13),map1.sync(map2),map2.sync(map1);var photo_layer=void 0,photo_attrib=void 0;"cadastre.openstreetmap.fr"==window.location.hostname?(photo_layer="http://proxy-ign.openstreetmap.fr/bdortho/{z}/{x}/{y}.jpg",photo_attrib='&copy; <a href="http://openstreetmap.fr/bdortho">BDOrtho IGN</a>'):(photo_layer="http://{s}.tiles.mapbox.com/v4/openstreetmap.map-inh7ifmo/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoib3BlbnN0cmVldG1hcCIsImEiOiJncjlmd0t3In0.DmZsIeOW-3x-C5eX-wAqTw",photo_attrib='&copy; <a href="https://www.mapbox.com/satellite/">Mapbox/DigitalGlobe</a>'),L.tileLayer(photo_layer,{attribution:photo_attrib,maxNativeZoom:19,maxZoom:21,minZoom:3}).addTo(map1),L.tileLayer("http://tms.cadastre.openstreetmap.fr/*/tout/{z}/{x}/{y}.png",{attribution:'&copy <a href="http://wiki.openstreetmap.org/wiki/Cadastre_Fran%C3%A7ais/Conditions_d%27utilisation">Direction Générale des Finances Publiques - Cadastre</a>',maxNativeZoom:21,maxZoom:21,minZoom:3}).addTo(map2);var GeometryError=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="GeometryError",n}return _inherits(t,e),t}(Error),ConnectionError=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="ConnectionError",n}return _inherits(t,e),t}(Error),style_big={color:"blue",stroke:!0,fill:!1,weight:4},style_small={color:"lightgreen",stroke:!0,fill:!1,weight:4},style_keep={color:"lightgreen",stroke:!0,fill:!1,weight:7},style_join={color:"red",stroke:!0,fill:!1,weight:6},style_none={stroke:!1},style_unknown={color:"yellow",stroke:!0,fill:!1,weight:3},JoinPolygons=function(){function e(t,n){_classCallCheck(this,e);var o=e.get_outers_and_intersect_latLngs(t,n),r=_slicedToArray(o,3);this.outer1_latLngs=r[0],this.outer2_latLngs=r[1],this.intersect_latLngs=r[2],this.outer1_polylines=[],this.outer2_polylines=[],this.intersect_polylines=[],this.blinkOn=!1,this.blinkInterval=null;var s=e.line_length(this.outer1_latLngs),i=e.line_length(this.outer2_latLngs);s>i?(this.style_outer1=style_big,this.style_outer2=style_small):(this.style_outer1=style_small,this.style_outer2=style_big)}return _createClass(e,[{key:"addTo",value:function(e){return this.outer1_polylines.push(L.polyline(this.outer1_latLngs,this.style_outer1).addTo(e)),this.outer2_polylines.push(L.polyline(this.outer2_latLngs,this.style_outer2).addTo(e)),this.intersect_polylines.push(L.polyline(this.intersect_latLngs,style_join).addTo(e)),this}},{key:"on",value:function(e,t,n){return this.outer1_polylines.forEach(function(o){return o.on(e,t,n)}),this.outer2_polylines.forEach(function(o){return o.on(e,t,n)}),this.intersect_polylines.forEach(function(o){return o.on(e,t,n)}),this}},{key:"remove",value:function(){this.outer1_polylines.forEach(function(e){return e.remove()}),this.outer2_polylines.forEach(function(e){return e.remove()}),this.intersect_polylines.forEach(function(e){return e.remove()}),clearInterval(this.blinkInterval)}},{key:"blink",value:function(){var e=this;this.blinkOn=!this.blinkOn,this.outer1_polylines.forEach(function(t){return t.setStyle(e.blinkOn?e.style_outer1:style_unknown)}),this.outer2_polylines.forEach(function(t){return t.setStyle(e.blinkOn?e.style_outer2:style_unknown)}),this.intersect_polylines.forEach(function(t){return t.setStyle(e.blinkOn?style_small:style_none)})}},{key:"showBlinking",value:function(){var e=this;clearInterval(this.blinkInterval),this.blinkOn=!1,this.blink(),this.blinkInterval=setInterval(function(){return e.blink()},500)}},{key:"showJoined",value:function(){clearInterval(this.blinkInterval),this.outer1_polylines.forEach(function(e){return e.setStyle(style_join)}),this.outer2_polylines.forEach(function(e){return e.setStyle(style_join)}),this.intersect_polylines.forEach(function(e){return e.setStyle(style_none)})}},{key:"showKept",value:function(){var e=this;clearInterval(this.blinkInterval),this.outer1_polylines.forEach(function(t){return t.setStyle(e.style_outer1)}),this.outer2_polylines.forEach(function(t){return t.setStyle(e.style_outer2)}),this.intersect_polylines.forEach(function(e){return e.setStyle(style_keep)})}},{key:"getBounds",value:function(){return this.outer1_polylines[0].getBounds().pad(0).extend(this.outer2_polylines[0].getBounds())}},{key:"getCenter",value:function(){return this.intersect_polylines[0].getCenter()}}],[{key:"line_length",value:function(e){e=e.map(function(e){return L.latLng(e)});for(var t=0,n=1;n<e.length;n++)t+=e[n].distanceTo(e[n-1]);return t}},{key:"get_outers_and_intersect_latLngs",value:function(e,t){function n(e,t){return e[0]==t[0]&&e[1]==t[1]}function o(e){return n(e[0],e[e.length-1])}if(!o(e)||!o(t))throw new GeometryError("not closed polygons");if(e=e.slice(1),t=t.slice(1),e.length<t.length){var r=e;e=t,t=r}var s=e.length,i=t.length,c=e.findIndex(function(e){return t.findIndex(function(t){return n(e,t)})<0});if(c==-1)throw new GeometryError("no distincts points");e=e.slice(c,s).concat(e.slice(0,c));var l=e.filter(function(e){return t.findIndex(function(t){return n(e,t)})>=0});if(c=e.findIndex(function(e){return n(e,l[0])}),c==-1)throw new GeometryError("no common points");e=e.slice(c,s).concat(e.slice(0,c));var a=e.filter(function(e){return l.findIndex(function(t){return n(e,t)})<0}),u=t.findIndex(function(e){return n(l[0],e)});n(t[(u+1)%i],l[1])&&(t.reverse(),u=i-1-u),t=t.slice(u,i).concat(t.slice(0,u));var d=t.filter(function(e){return l.findIndex(function(t){return n(t,e)})<0}),h=l.slice(-1).concat(a).concat(l.slice(0,1)),_=l.slice(0,1).concat(d).concat(l.slice(-1));return[h,_,l]}}]),e}(),joinPolygons=null;document.getElementById("button-join").addEventListener("mouseenter",function(){null!=joinPolygons&&joinPolygons.showJoined()}),document.getElementById("button-keep").addEventListener("mouseenter",function(){null!=joinPolygons&&joinPolygons.showKept()}),document.getElementById("button-join").addEventListener("mouseleave",function(){null!=joinPolygons&&joinPolygons.showBlinking()}),document.getElementById("button-keep").addEventListener("mouseleave",function(){null!=joinPolygons&&joinPolygons.showBlinking()}),document.getElementById("button-join").addEventListener("click",function(){return choose("join",!1)}),document.getElementById("button-keep").addEventListener("click",function(){return choose("keep",!1)}),document.getElementById("button-unknown").addEventListener("click",function(){return choose("unknown",!1)}),document.getElementById("button-back").addEventListener("click",function(){return go_back(!1)}),document.body.addEventListener("keydown",function(e){switch(e.keyCode){case 48:case 96:choose("unknown",!0);break;case 49:case 97:choose("join",!0);break;case 50:case 98:choose("keep",!0);break;case 8:go_back(!0)}});var cases=[],cases_ids=new Set,cur_index=-1,request_send=!1,need_display=!1,got_connection_error=!1,session=Math.round(2147483647*Math.random()),stats={contributions_distinct_ips:null,cases:null,contributions:null,contributions_distinct_cases:null,contributions_from_ip:0};window.addEventListener("hashchange",function(){id=parseInt(location.hash.substring(1)),id!=parseInt("")&&cur_index<cases.length&&id!=cases[cur_index].id&&next(!1,id)}),next(!1,location.hash.length>0?parseInt(location.hash.substring(1)):null)},{"./findIndex":5,"es6-promise":1,"leaflet.sync":2,"whatwg-fetch":4}]},{},[6]);